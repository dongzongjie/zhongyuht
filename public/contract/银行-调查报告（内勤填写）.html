<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>银行-调查报告（内勤填写）</title>
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        
        .box {
            width: 794px;
            background-color: #fff;
            padding: 60px 13px 123px;
            box-sizing: border-box;
        }
        
        h1 {
            font-size: 18px;
            text-align: center;
            margin: 0;
            font-weight: normal;
        }
        
        p {
            margin: 0;
            font-size: 14px;
            text-indent: 9em;
        }
        
        table {
            margin: 0 auto;
            width: 100%;
        }
        
        th,
        td {
            font-weight: normal;
            font-size: 14px;
            text-align: center;
        }
        
        input {
            border: 0;
            border-bottom: 1px solid #000;
            outline: none;
        }
        
        button {
            position: fixed;
            top: 30px;
            left: 0;
        }
        
        #bt {
            position: fixed;
            top: 80px;
            left: 0;
        }
    </style>
    <script src="https://cdn.bootcss.com/html2canvas/0.5.0-beta4/html2canvas.js"></script>
    <script src="https://cdn.bootcss.com/jspdf/1.3.4/jspdf.debug.js"></script>
</head>

<body>
    <button onclick="printOut('郑州分行信用卡汽车分期付款业务调查报告2020版')">点击下载合同</button>
    <button id="bt">点击打印</button>
    <div class="box" id="PDF">
        <h1>郑州分行信用卡汽车分期付款业务调查报告2020版</h1>
        <br>
        <p>业务经办行：花园路支行 <span style="margin-left: 190px;">填报日期：2020-10-19</span></p>
        <table border="1" cellspacing="0">
            <!-- 第一行 -->
            <tr>
                <th rowspan="3">申请人基本信息</th>
                <th>姓名</th>
                <th colspan="2" class="dkrname"><span style="color: red;">{{贷款人姓名}}</span></th>
                <th>证件号码</th>
                <th colspan="2" class="dkridCard"><span style="color: red;">{{贷款人身份证号}}</span></th>
                <th>联系电话</th>
                <th colspan="2" class="dkrphone"><span style="color: red;">{{贷款人电话}}</span></th>
            </tr>
            <!-- 第二行 -->
            <tr>
                <td colspan="2">共同偿债人/配偶姓名</td>
                <td></td>
                <td>证件号码</td>
                <td colspan="2"></td>
                <td>联系电话</td>
                <td colspan="2"></td>
            </tr>
            <!-- 第三行 -->
            <tr>
                <td colspan="2">家庭住址</td>
                <td colspan="6" class="dkraddress"><span style="color: red;">{{贷款人户籍地址}}</span></td>
            </tr>
            <!-- 第四行 -->
            <tr>
                <td rowspan="3">购买车辆情况</td>
                <td colspan="2">汽车品牌</td>
                <td colspan="2" class="clpp"><span style="color: red;">{{车辆品牌}}</span></td>
                <td>汽车型号</td>
                <td width="10%"></td>
                <td>车架号</td>
                <td class="clsbdh"><span style="color: red;">{{车辆识别代号}}</span></td>
            </tr>
            <!-- 第五行 -->
            <tr>
                <td>成交价</td>
                <td class="cljg"><span style="color: red;">{{车辆价格}}</span></td>
                <td>保单车价</td>
                <td></td>
                <td>保单第一受益人</td>
                <td colspan="3"><input type="checkbox" name="" id=""> 中国工商银行股份有限公司郑州花园路支行</td>
            </tr>
            <!-- 第六行 -->
            <tr>
                <td>首付款比例 %</td>
                <td class="sfbl"><span style="color: red;">{{首付比例}}</span></td>
                <td>附加费分期本金/车辆价格比例</td>
                <td></td>
                <td>上牌地(具体到市)</td>
                <td width="10%"></td>
                <td><input type="checkbox" name="" id="">新车</td>
                <td><input type="checkbox" name="" id="">二手车评估价： 万元</td>
            </tr>
            <!-- 第七行 -->
            <tr>
                <td rowspan="2">申请分期事项</td>
                <td>首付款金额</td>
                <td colspan="2" class="sfk"><span style="color: red;">{{首付款}}</span></td>
                <td>分期期限</td>
                <td colspan="2" class="dkqx"><span style="color: red;">{{贷款期限}}</span></td>
                <td>分期手续费率 %</td>
                <td>8.5</td>
            </tr>
            <!-- 第八行 -->
            <tr>
                <td>购车分期本金</td>
                <td colspan="2" class="clwk"><span style="color: red;">{{车辆尾款}}</span></td>
                <td>附加费分期本金</td>
                <td colspan="2" class="zxfwglf"><span style="color: red;">{{咨询服务管理费}}</span></td>
                <td>分期本金合计</td>
                <td class="dkje"><span style="color: red;">{{贷款金额}}</span></td>
            </tr>
            <!-- 第九行 -->
            <tr>
                <td>申请人资信状况</td>
                <td colspan="8" style="text-align: left;">
                    <div>征信CIIS等级：<input type="checkbox" name="" id="">正常 <input type="checkbox" name="" id=""><input type="text">
                    </div>
                    <div>风险筛查结论：<input type="checkbox" name="" id="">未匹配到参数 <input type="checkbox" name="" id=""><input type="text"></div>
                    <div>准入决策结果：<input type="checkbox" name="" id="">通过<input type="checkbox" name="" id=""><input type="text">
                    </div>
                    <div>授信决策结果：<input type="checkbox" name="" id="">通过<input type="checkbox" name="" id=""><input type="text">
                    </div>
                    <div>其他说明：</div>
                </td>
            </tr>
            <!-- 第十行 -->
            <tr>
                <td>收入还款能力分析</td>
                <td colspan="8" style="text-align: left;">
                    <div>职业：<input type="text">。申请人月收入：<input type="text"> ；共同偿债人（如有）收入：<input type="text"> ；申请人及共同偿债人月平均收入 <input type="text">元，申请人及共同偿债人月还款（含本笔分期） <input type="text">元，其中本笔分期业务申请人月还款额为<input type="text"> 元。</div>
                    <div> 其他说明：（如有对外担保等其他情况请补充说明）</div>
                </td>
            </tr>
            <!-- 第十一行 -->
            <tr>
                <td>业务担保及相关情况</td>
                <td colspan="8" style="text-align: left;">
                    <div><input type="checkbox" name="" id="">抵押人（共有人）担保意愿真实，抵押物足值，真实，产权清晰，价值合理。
                        <input type="checkbox" name="" id="">“ 融资担保有限公司”提供连带责任保证担保（在分行担保名单内）。
                        <input type="checkbox" name="" id="">采用保证保险方式，保险公司已出具承包意向书。</div>
                    <div>合作机构<input type="text">已先为申请人垫付款项<input type="text">元。</div>
                </td>
            </tr>
            <!-- 第十二行 -->
            <tr>
                <td>申请资料调查情况</td>
                <td colspan="8" style="text-align: left;">
                    <div><input type="checkbox" name="" id="">网点面签 <input type="checkbox" name="" id="">实时视频面签 <input type="checkbox" name="" id="">购车人提车照片 <input type="checkbox" name="" id="">家访照片 </div>
                    <div><input type="checkbox" name="" id="">购车发票验真 <input type="checkbox" name="" id="">车辆保单验真</div>
                    <div>其他说明:</div>
                </td>
            </tr>
            <!-- 第十三行 -->
            <tr>
                <td colspan="9">支行调查意见</td>
            </tr>
            <!-- 第十四行 -->
            <tr>
                <td colspan="9">
                    <div style="height: 50px;"></div>
                    <div>第一调查人签字： <span style="margin-left: 250px;">第二调查人签字：</span></div>
                </td>
            </tr>
        </table>
    </div>
</body>

<script>
    // 接收VUE数据
    window.addEventListener("message", function(event) {
        let dkrname = document.querySelector('.dkrname')
        let dkridCard = document.querySelector('.dkridCard')
        let dkrphone = document.querySelector('.dkrphone')
        let dkraddress = document.querySelector('.dkraddress')
        let clpp = document.querySelector('.clpp')
        let clsbdh = document.querySelector('.clsbdh')
        let cljg = document.querySelector('.cljg')
        let sfbl = document.querySelector('.sfbl')
        let sfk = document.querySelector('.sfk')
        let dkqx = document.querySelector('.dkqx')
        let clwk = document.querySelector('.clwk')
        let zxfwglf = document.querySelector('.zxfwglf')
        let dkje = document.querySelector('.dkje')
        dkrname.innerHTML = event.data.jiekuanren.userName
        dkridCard.innerHTML = event.data.jiekuanren.idCard
        dkrphone.innerHTML = event.data.jiekuanren.phoneNumber
        dkraddress.innerHTML = event.data.jiekuanren.familyAddress
        clpp.innerHTML = event.data.chedai.brank
        clsbdh.innerHTML = ''
        cljg.innerHTML = event.data.chedai.actualPrice
        sfbl.innerHTML = ''
        sfk.innerHTML = event.data.chedai.actualPrice - event.data.chedai.loanAmount
        dkqx.innerHTML = event.data.chedai.repaymentTerm
        clwk.innerHTML = event.data.chedai.loanAmount
        zxfwglf.innerHTML = ''
        dkje.innerHTML = event.data.chedai.loanAmount
        if (event.data.isDownload) return printOut('银行-调查报告（内勤填写）')
    })

    // PDF
    function printOut(name) {
        let shareContent = document.querySelector('#PDF'), //需要截图的包裹的（原生的）DOM 对象
            width = shareContent.clientWidth, //获取dom 宽度
            height = shareContent.clientHeight, //获取dom 高度
            canvas = document.createElement("canvas"), //创建一个canvas节点
            scale = 2; //定义任意放大倍数 支持小数
        canvas.width = width * scale; //定义canvas 宽度 * 缩放
        canvas.height = height * scale; //定义canvas高度 *缩放
        canvas.style.width = shareContent.clientWidth * scale + "px";
        canvas.style.height = shareContent.clientHeight * scale + "px";
        canvas.getContext("2d").scale(scale, scale); //获取context,设置scale
        let opts = {
            scale: scale, // 添加的scale 参数
            canvas: canvas, //自定义 canvas
            logging: false, //日志开关，便于查看html2canvas的内部执行流程
            width: width, //dom 原始宽度
            height: height,
            useCORS: true, // 【重要】开启跨域配置
        };

        html2canvas(shareContent, opts).then(() => {
            var contentWidth = canvas.width;
            var contentHeight = canvas.height;
            //一页pdf显示html页面生成的canvas高度;
            var pageHeight = (contentWidth / 592.28) * 841.89;
            //未生成pdf的html页面高度
            var leftHeight = contentHeight;
            //页面偏移
            var position = 0;
            //a4纸的尺寸[595.28,841.89]，html页面生成的canvas在pdf中图片的宽高
            var imgWidth = 595.28;
            var imgHeight = (592.28 / contentWidth) * contentHeight;
            var pageData = canvas.toDataURL("image/jpeg", 1.0);
            var PDF = new jsPDF("", "pt", "a4");
            if (leftHeight < pageHeight) {
                PDF.addImage(pageData, "JPEG", 0, 0, imgWidth, imgHeight);
            } else {
                while (leftHeight > 0) {
                    PDF.addImage(pageData, "JPEG", 0, position, imgWidth, imgHeight);
                    leftHeight -= pageHeight;
                    position -= 841.89;
                    if (leftHeight > 0) {
                        PDF.addPage();
                    }
                }
            }
            PDF.save(name + ".pdf"); // 这里是导出的文件名
        });
    }

    // 打印
    function printdiv(printpage) {
        var newstr = printpage.innerHTML;
        var oldstr = document.body.innerHTML;
        document.body.innerHTML = newstr;
        window.print();
        document.body.innerHTML = oldstr;
        return false;
    }
    var bt = document.getElementById("bt");
    var div_print = document.getElementById("PDF");
    bt.onclick = function() {
        printdiv(div_print);
    }
</script>

</html>